import geopy.distance
import json

# https://stackoverflow.com/questions/31640252/get-latitude-and-longitude-points-along-a-line-between-two-points-by-percentage
def pointAtPercent(p0, p1, percent):
    if p0[0] != p1[0]:
        x = p0[0] + percent * (p1[0] - p0[0]);
    else:
        x = p0[0];

    if p0[1] != p1[1]:
        y = p0[1] + percent * (p1[1] - p0[1]);
    else:
        y = p0[1];

    return [x,y]
    
points = [ [ 47.609455, -122.341845 ],
  [ 47.609471, -122.341873 ],
  [ 47.609641, -122.34216 ],
  [ 47.609697, -122.342252 ],
  [ 47.610364, -122.343364 ],
  [ 47.610414, -122.343447 ],
  [ 47.61042, -122.343438 ],
  [
    47.61042,
    -122.343438
  ],
  [
    47.610471,
    -122.343364
  ],
  [
    47.610714,
    -122.343018
  ],
  [
    47.610985,
    -122.342704
  ],
  [
    47.611069,
    -122.342607
  ],
  [
    47.611141,
    -122.342528
  ],
  [
    47.611404,
    -122.342193
  ],
  [
    47.611662,
    -122.341867
  ],
  [
    47.61173,
    -122.341779
  ],
  [
    47.611828,
    -122.341653
  ],
  [
    47.612056,
    -122.341293
  ],
  [
    47.612306,
    -122.340973
  ],
  [
    47.612389,
    -122.340865
  ],
  [
    47.612466,
    -122.340767
  ],
  [
    47.612724,
    -122.340435
  ],
  [
    47.612803,
    -122.340333
  ],
  [
    47.612803,
    -122.340333
  ],
  [
    47.612972,
    -122.340116
  ],
  [
    47.613048,
    -122.34002
  ],
  [
    47.61314,
    -122.339899
  ],
  [
    47.613399,
    -122.339589
  ],
  [
    47.613667,
    -122.339265
  ],
  [
    47.613735,
    -122.339175
  ],
  [
    47.613798,
    -122.339091
  ],
  [
    47.614051,
    -122.338744
  ],
  [
    47.614316,
    -122.338424
  ],
  [
    47.614326,
    -122.338412
  ],
  [
    47.614392,
    -122.338332
  ],
  [
    47.614474,
    -122.338221
  ],
  [
    47.614478,
    -122.338217
  ],
  [
    47.614728,
    -122.337873
  ],
  [
    47.614779,
    -122.337813
  ],
  [
    47.614826,
    -122.337749
  ],
  [
    47.614865,
    -122.3377
  ],
  [
    47.614931,
    -122.337602
  ],
  [
    47.615057,
    -122.337446
  ],
  [
    47.615081,
    -122.337415
  ],
  [
    47.615122,
    -122.337363
  ],
  [
    47.615387,
    -122.337013
  ],
  [
    47.615543,
    -122.336808
  ],
  [
    47.615543,
    -122.336809
  ],
  [
    47.615657,
    -122.33666
  ],
  [
    47.615723,
    -122.336573
  ],
  [
    47.615772,
    -122.336511
  ],
  [
    47.616054,
    -122.336152
  ],
  [
    47.616333,
    -122.335797
  ],
  [
    47.616388,
    -122.335728
  ],
  [
    47.616441,
    -122.335659
  ],
  [
    47.61663,
    -122.335416
  ],
  [
    47.616713,
    -122.335309
  ],
  [
    47.616985,
    -122.334956
  ],
  [
    47.617062,
    -122.334856
  ],
  [
    47.6171,
    -122.334807
  ],
  [
    47.617386,
    -122.334445
  ],
  [
    47.617479,
    -122.334345
  ],
  [
    47.617527,
    -122.334248
  ],
  [
    47.617583,
    -122.334167
  ],
  [
    47.617595,
    -122.334149
  ],
  [
    47.617638,
    -122.334094
  ],
  [
    47.617722,
    -122.334012
  ],
  [
    47.617727,
    -122.334021
  ],
  [
    47.617727,
    -122.334021
  ],
  [
    47.617722,
    -122.334012
  ],
  [
    47.617666,
    -122.333917
  ],
  [
    47.61755,
    -122.333718
  ],
  [
    47.617497,
    -122.333629
  ],
  [
    47.617389,
    -122.333445
  ],
  [
    47.617164,
    -122.333063
  ],
  [
    47.617095,
    -122.332946
  ],
  [
    47.617025,
    -122.332828
  ],
  [
    47.616954,
    -122.332705
  ],
  [
    47.6169,
    -122.332615
  ],
  [
    47.616721,
    -122.332316
  ],
  [
    47.61653,
    -122.331998
  ],
  [
    47.616417,
    -122.331809
  ],
  [
    47.616237,
    -122.331508
  ],
  [
    47.616184,
    -122.331421
  ],
  [
    47.616128,
    -122.331368
  ],
  [
    47.61582,
    -122.331074
  ],
  [
    47.615532,
    -122.330798
  ],
  [
    47.615473,
    -122.330742
  ],
  [
    47.615473,
    -122.330742
  ],
  [
    47.615459,
    -122.330729
  ],
  [
    47.6155,
    -122.330632
  ],
  [
    47.615869,
    -122.329758
  ],
  [
    47.615921,
    -122.329639
  ],
  [
    47.616287,
    -122.328777
  ],
  [
    47.616287,
    -122.328777
  ],
  [
    47.616367,
    -122.328589
  ],
  [
    47.616448,
    -122.328335
  ],
  [
    47.616648,
    -122.327894
  ],
  [
    47.616648,
    -122.327894
  ],
  [
    47.616654,
    -122.327881
  ],
  [
    47.616561,
    -122.327881
  ],
  [
    47.615965,
    -122.327884
  ],
  [
    47.615872,
    -122.327884
  ],
  [
    47.615685,
    -122.327889
  ],
  [
    47.615344,
    -122.327897
  ],
  [
    47.615257,
    -122.327898
  ],
  [
    47.615257,
    -122.327898
  ],
  [
    47.615225,
    -122.327899
  ],
  [
    47.615222,
    -122.327938
  ],
  [
    47.615217,
    -122.327977
  ],
  [
    47.615209,
    -122.328015
  ],
  [
    47.615199,
    -122.328051
  ],
  [
    47.615187,
    -122.328086
  ],
  [
    47.615161,
    -122.328152
  ],
  [
    47.615092,
    -122.32832
  ],
  [
    47.615012,
    -122.328511
  ],
  [
    47.614935,
    -122.328696
  ],
  [
    47.614836,
    -122.328927
  ],
  [
    47.614502,
    -122.329702
  ],
  [
    47.614457,
    -122.329806
  ],
  [
    47.614404,
    -122.329936
  ],
  [
    47.614151,
    -122.330546
  ],
  [
    47.614035,
    -122.330824
  ],
  [
    47.613682,
    -122.331668
  ],
  [
    47.613585,
    -122.331901
  ],
  [
    47.613528,
    -122.332038
  ],
  [
    47.613476,
    -122.332164
  ],
  [
    47.613442,
    -122.332244
  ],
  [
    47.613352,
    -122.33246
  ],
  [
    47.613283,
    -122.332628
  ],
  [
    47.613123,
    -122.333011
  ],
  [
    47.61306,
    -122.333163
  ],
  [
    47.613019,
    -122.333262
  ],
  [
    47.612856,
    -122.333653
  ],
  [
    47.612634,
    -122.334165
  ],
  [
    47.612595,
    -122.334263
  ],
  [
    47.612558,
    -122.334356
  ],
  [
    47.612373,
    -122.334813
  ],
  [
    47.612177,
    -122.335284
  ],
  [
    47.612137,
    -122.335381
  ],
  [
    47.612102,
    -122.335464
  ],
  [
    47.611906,
    -122.335935
  ],
  [
    47.611761,
    -122.336284
  ],
  [
    47.611734,
    -122.336349
  ],
  [
    47.611683,
    -122.336471
  ],
  [
    47.611609,
    -122.33665
  ],
  [
    47.611489,
    -122.336937
  ],
  [
    47.611471,
    -122.33698
  ],
  [
    47.611266,
    -122.337473
  ],
  [
    47.6112,
    -122.337633
  ],
  [
    47.611138,
    -122.33778
  ],
  [
    47.611038,
    -122.33802
  ],
  [
    47.610811,
    -122.338565
  ],
  [
    47.610745,
    -122.338721
  ],
  [
    47.610688,
    -122.338859
  ],
  [
    47.610522,
    -122.339253
  ],
  [
    47.610346,
    -122.339683
  ],
  [
    47.61028,
    -122.339842
  ],
  [
    47.610227,
    -122.339971
  ],
  [
    47.610106,
    -122.340262
  ],
  [
    47.610062,
    -122.340366
  ],
  [
    47.610034,
    -122.340435
  ],
  [
    47.609964,
    -122.340601
  ]
]

velocity_points = []
stride = 10
distance_since_last_stride = 0.0
remainder = 0 

i = 0
while i < len(points):
    if i == 0:
        i += 1
    else:
        coords_1 = points[i-1]
        coords_2 = points[i]
        remainder += geopy.distance.distance(coords_1, coords_2).m
        # print(i, "remainder", remainder)
        
        while distance_since_last_stride + remainder >= stride:
            # print("cut this seg.  need to travel", stride - distance_since_last_stride)
            cut_at = (stride - distance_since_last_stride) / remainder
            coords_1 = pointAtPercent(coords_1, coords_2, cut_at)
            distance_since_last_stride = 0
            # print(i, "adding", add_point)
            velocity_points.append(coords_1)
            remainder = geopy.distance.distance(coords_1, coords_2).m
            if remainder < stride:
                distance_since_last_stride = remainder
                break
        i += 1


print(json.dumps(velocity_points, indent=2))